<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data Preparation • week2DataChallenge</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Data Preparation">
<meta property="og:description" content="week2DataChallenge">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">week2DataChallenge</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/CompositionalDataAnalysisTutorial.html">Compositional Data Analysis Tutorial</a>
    </li>
    <li>
      <a href="../articles/DataPrep.html">Data Preparation</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="DataPrep_files/header-attrs-2.6/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Data Preparation</h1>
            
      
      
      <div class="hidden name"><code>DataPrep.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">week2DataChallenge</span><span class="op">)</span></code></pre></div>
<p>This tutorial is on pre-processing for non-accelerometer data. Pre-processing is an important part of the project pipeline – we hope this will give you a lot of flexibility e.g. to decide what variables you want to work with. This tutorial contains:</p>
<ol style="list-style-type: decimal">
<li>Introduction to available data</li>
<li>Processing covariate data</li>
<li>Processing health outcomes data</li>
<li>Merging data files</li>
<li>Finding out more</li>
</ol>
<div id="introduction-to-available-data" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction-to-available-data" class="anchor"></a>Introduction to available data</h1>
<p>Different files are available from UK Biobank for different data types. We will use these files, available under <code>data_files</code>:</p>
<ul>
<li>
<code>ukb41733.enc</code>: A ‘standard’ dataset, with one line per participant. It contains most ‘straightforward’ data e.g. sex, age at assessment centre visit, blood biomarkers, BMI, smoking status etc.</li>
<li>
<code>hesin_all.csv</code>: Hospital Episode Statistics data. Each line is associated with an in-hospital diagnosis.</li>
<li>
<code>death.txt</code>: Death register data. This has one line per participant who has died, giving details of their death.</li>
<li>Accelerometer data, used last week.</li>
</ul>
</div>
<div id="processing-covariate-data" class="section level1">
<h1 class="hasAnchor">
<a href="#processing-covariate-data" class="anchor"></a>Processing covariate data</h1>
<p>We will make use of a repo that Shing and Rosemary have developed for this purpose. <a href="https://ukb-download-and-prep-template.readthedocs.io/en/latest/started.html" class="external-link">Read the docs</a> and <a href="https://ukb-download-and-prep-template.readthedocs.io/en/latest/download.html#downloading-participant-data" class="external-link">find it on GitHub</a>.</p>
<p>There are three key steps:</p>
<ul>
<li><a href="https://ukb-download-and-prep-template.readthedocs.io/en/latest/started.html#installation" class="external-link">Installation</a></li>
<li><a href="https://ukb-download-and-prep-template.readthedocs.io/en/latest/download.html#extracting-participant-data-to-csv" class="external-link">Extracting a .csv file from the .enc_ukb file</a></li>
<li><a href="https://ukb-download-and-prep-template.readthedocs.io/en/latest/core.html#relabelling-and-recoding-participant-data" class="external-link">Automated pre-processing of all variables</a></li>
</ul>
<p>Most of the time, you can use this in a fairly blind way. However, <em>a word of caution</em>: variables in UK Biobank come with instances and repeats. In the csv file beefore processing, they are named as fieldnumber.repeat.instance (e.g. 2443.1.0 for the first instance at the repeat visit). Repeat 1 was a resurvey among a limited number of participants, repeat 2 is the imaging revisit. Both apply only to a subset of participants. More importantly, some variables have multiple instances, as participants could check multiple boxes (e.g. <a href="https://biobank.ndph.ox.ac.uk/ukb/field.cgi?id=6138%5D%20on%20qualifications" class="external-link">6138</a> or had multiple measures take (e.g. blood pressure measurements) In these cases, you’ll have to <a href="https://ukb-download-and-prep-template.readthedocs.io/en/latest/advanced.html" class="external-link">change the defaults</a> to usefully use the variables.</p>
<p>Finding this hard to use? Spotted a bug? We’d love to get feedback and to make it as user-friendly as possible.</p>
</div>
<div id="processing-health-outcomes-data" class="section level1">
<h1 class="hasAnchor">
<a href="#processing-health-outcomes-data" class="anchor"></a>Processing health outcomes data</h1>
<p>The next step is to add health outcomes data to the covariate data file. Follow <a href="https://ukb-download-and-prep-template.readthedocs.io/en/latest/core.html#adding-hospital-episode-statistics" class="external-link">these steps</a>.</p>
<p>Note that this describes working with Hospital Episode Statistics (<code>hesin_all.csv</code>). You might also want to work with data on deaths</p>
</div>
<div id="merging-data-files" class="section level1">
<h1 class="hasAnchor">
<a href="#merging-data-files" class="anchor"></a>Merging data files</h1>
<p>You can merge data files using the ‘eid’ column. Note that with accelerometer data, the ‘eid’ column may need adjusting to remove extra text e.g. </p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">acc</span><span class="op">$</span><span class="va">eid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"_90001_0_0.cwa.gz"</span>, <span class="st">""</span>, <span class="va">acc</span><span class="op">$</span><span class="va">eid</span><span class="op">)</span> <span class="co"># This line replaces the first string with the second one wherever it appears in acc$eid</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">acc</span>, by <span class="op">=</span> <span class="st">"eid"</span><span class="op">)</span></code></pre></div>
</div>
<div id="troubleshooting" class="section level1">
<h1 class="hasAnchor">
<a href="#troubleshooting" class="anchor"></a>Troubleshooting</h1>
<p>Please note the repo contains lots of generic filenames – you need to update them to your own filename.</p>
<p>If nothing is working: we have a pre-processed dataset you can use. Speak to Rosemary – <a href="mailto:rosemary.walmsley@gtc.ox.ac.uk" class="email">rosemary.walmsley@gtc.ox.ac.uk</a>.</p>
</div>
<div id="finding-out-more" class="section level1">
<h1 class="hasAnchor">
<a href="#finding-out-more" class="anchor"></a>Finding out more</h1>
<p>To find out more about particular UK Biobank variables, use the <a href="https://biobank.ndph.ox.ac.uk/ukb/" class="external-link">Data Showcase</a></p>
<p>To find out more about UK Biobank data collection and history:</p>
<p>In addition to what we’ve shared here, UK Biobank is an open resource and several other open-source tools are available to support its use (<a href="https://git.fmrib.ox.ac.uk/fsl/funpack" class="external-link">an example</a>)</p>
<p>In the future, UK Biobank will be moving to an <a href="https://www.ukbiobank.ac.uk/learn-more-about-uk-biobank/news/uk-biobank-creates-cloud-based-health-data-analysis-platform-to-unleash-the-imaginations-of-the-world-s-best-scientific-minds" class="external-link">analysis platform model</a> model.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by .</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link external-link">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
