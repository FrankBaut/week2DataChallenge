<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Compositional Data Analysis Tutorial • week2DataChallenge</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Compositional Data Analysis Tutorial">
<meta property="og:description" content="week2DataChallenge">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">week2DataChallenge</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/0_GettingSetupWithRStudio.html">Getting Set Up With RStudio</a>
    </li>
    <li>
      <a href="../articles/1_DataPrep.html">Data Preparation</a>
    </li>
    <li>
      <a href="../articles/2_HealthAssociationAnalysis.html">Introduction to Health Association Analysis for Movement Behaviour Data</a>
    </li>
    <li>
      <a href="../articles/3_IntroToCompositionalDataAnalysis.html">Compositional Data Analysis Tutorial</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="3_IntroToCompositionalDataAnalysis_files/header-attrs-2.6/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Compositional Data Analysis Tutorial</h1>
            
      
      
      <div class="hidden name"><code>3_IntroToCompositionalDataAnalysis.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"ggplot2"</span><span class="op">)</span> <span class="co"># Plotting works better with ggplot2</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span> <span class="co"># To install epicoda from GitHub, the devtools package is required.</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/">devtools</a></span><span class="op">)</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"activityMonitoring/epicoda"</span>,  build_opts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"--no-resave-data"</span><span class="op">)</span>, build_vignettes <span class="op">=</span> <span class="cn">TRUE</span>, build_manual <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># TROUBLESHOOTING if this doesn't work, use build_vignettes = FALSE. You have the info from the vignette here!</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">epicoda</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="co">#&gt; Warning: package 'ggplot2' was built under R version 4.0.4</span></code></pre></div>
<div id="a-basic-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#a-basic-analysis" class="anchor"></a>A basic analysis</h1>
<p>This tutorial illustrates some steps of an epidemiological analysis with a compositional exposure. It uses a package, <code>epicoda</code>, we have developed for this purpose. More information about any function we use can be found by running <code>?function_name</code> (as usual). Please note that the package is under active (including very recent!) development, and has been tested in a limited range of scenarios, so you may well find bugs. If you do, or if anything isn’t clear, please do get in touch! (<a href="mailto:rosemary.walmsley@gtc.ox.ac.uk" class="email">rosemary.walmsley@gtc.ox.ac.uk</a>)</p>
<p>This tutorial is closely based on one of the package vignettes… Which was itself based on an earlier version of this tutorial!</p>
<div id="getting-started-with-compositional-data" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-started-with-compositional-data" class="anchor"></a>Getting started with compositional data</h2>
<div id="loading-simulated-data" class="section level3">
<h3 class="hasAnchor">
<a href="#loading-simulated-data" class="anchor"></a>Loading simulated data</h3>
<p><code>simdata</code> is a (simulated) compositional dataset in the package. It has 5 columns which make up a hypothetical movement behaviour composition: “vigorous” (activity), “moderate” (activity), “light” (activity), “sedentary” (behaviour), “sleep.” It also contains sex, age group and outcome columns. As the data is simulated, all results are hypothetical.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">simdata</span><span class="op">)</span>
<span class="co">#&gt;   X    sex        agegroup follow_up_time event      BMI disease    vigorous</span>
<span class="co">#&gt; 1 1 Female   Second oldest             24  TRUE 29.11778       0 0.001590611</span>
<span class="co">#&gt; 2 2   Male Second youngest             23 FALSE 26.79845       0 0.004381269</span>
<span class="co">#&gt; 3 3 Female          Middle             21 FALSE 31.36632       0 0.047306815</span>
<span class="co">#&gt; 4 4   Male          Middle             17 FALSE 32.86039       0 0.020263872</span>
<span class="co">#&gt; 5 5 Female   Second oldest             14 FALSE 34.84146       0 0.002266761</span>
<span class="co">#&gt; 6 6 Female          Middle             14 FALSE 23.18320       0 0.021275985</span>
<span class="co">#&gt;    moderate    light sedentary     sleep</span>
<span class="co">#&gt; 1 0.3530120 2.468326 11.417090  9.759981</span>
<span class="co">#&gt; 2 1.1266360 5.496150  8.915976  8.456856</span>
<span class="co">#&gt; 3 1.4938324 2.900905 10.112896  9.445060</span>
<span class="co">#&gt; 4 1.8193326 4.162118  9.858822  8.139463</span>
<span class="co">#&gt; 5 0.9698058 3.718406 11.035129  8.274393</span>
<span class="co">#&gt; 6 2.0291247 4.353933  5.974741 11.620925</span></code></pre></div>
</div>
<div id="what-is-compositional-data" class="section level3">
<h3 class="hasAnchor">
<a href="#what-is-compositional-data" class="anchor"></a>What is compositional data?</h3>
<p>Data is compositional when the <em>relative</em> (not absolute) values of the variables are relevant to the problem being studied <span class="citation">(Filzmoser, Hron, and Templ 2018)</span>. Another way to describe this is that compositional data is data that can be expressed as proportions of a whole without losing information.</p>
<p>Here, the compositional variables sum to the same total (24- the number of hours in the day), which is a common situation. As this means it is not possible to simply increase time in one behaviour - it is only possible to spend time in one behaviour rather than in another behaviour - it is the relative values that are relevant.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">simdata</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"vigorous"</span>, <span class="st">"moderate"</span>, <span class="st">"light"</span>, <span class="st">"sedentary"</span>, <span class="st">"sleep"</span><span class="op">)</span><span class="op">]</span>, <span class="fl">1</span>, <span class="va">sum</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 24 24 24 24 24 24</span></code></pre></div>
<p>Other examples of compositional data don’t have a fixed sum. For example, consider the vote counts in an election for different parties in different constituencies: although the overall number of votes cast might differ between constituencies, it is the proportion of the vote going to each party, and not the total number of votes going to that party in a given constituency, that is relevant.</p>
<div id="notes" class="section level4">
<h4 class="hasAnchor">
<a href="#notes" class="anchor"></a>Notes</h4>
<ul>
<li>The variables in compositional data are often known as <em>parts</em>.</li>
<li>In Compositional Data Analysis, expressing the data as proportions of a whole is known as taking the <em>closure</em>, written and defined as:</li>
</ul>
<p><span class="math display">\[\begin{equation}
  \mathcal{C}(part_{1}, part_{2}, ..., part_{D}) = \Big(\frac{part_{1}}{\sum_{i =1}^{D}{part_i}}, \frac{part_{2}}{\sum_{i =1}^{D}{part_i}}, ..., \frac{part_{D}}{\sum_{i =1}^{D}{part_i}}\Big)
\end{equation}\]</span></p>
</div>
</div>
</div>
<div id="exploratory-data-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#exploratory-data-analysis" class="anchor"></a>Exploratory data analysis</h2>
<div id="the-compositional-mean" class="section level3">
<h3 class="hasAnchor">
<a href="#the-compositional-mean" class="anchor"></a>The compositional mean</h3>
<p>The compositional mean is a frequently-used summary statistic for compositional data <span class="citation">(Filzmoser, Hron, and Templ 2018)</span>. It is found by taking the geometric mean of each component, then taking the closure so they sum to the overall total. Like the standard (multivariate) mean it is a measure of location, or central tendency. Unlike the standard mean, it interacts in an appropriate way with compositional data.</p>
<p>To calculate the compositional mean of columns <code>"vigorous", "moderate", "light", "sedentary", "sleep"</code> using <code>epicoda</code>, we run:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/epicoda/man/comp_mean.html">comp_mean</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">simdata</span>, <span class="co"># this is the dataset</span>
          comp_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"vigorous"</span>, <span class="st">"moderate"</span>, <span class="st">"light"</span>, <span class="st">"sedentary"</span>, <span class="st">"sleep"</span><span class="op">)</span> <span class="co"># this is the labels of the compositional columns,</span>
          <span class="co"># which we specified above</span>
          <span class="op">)</span>
<span class="co">#&gt; det_limit was imputed as the minimum value observed in the compositional</span>
<span class="co">#&gt;          columns of data; </span>
<span class="co">#&gt;  if this is an unrealistic det_limit, the results may be unreliable.</span>
<span class="co">#&gt; Zeroes were imputed with detection limit </span>
<span class="co">#&gt;  4.96e-05  (on the unitless scale) using zCompositions::lrEM</span>
<span class="co">#&gt;       vigorous   moderate     light sedentary     sleep</span>
<span class="co">#&gt; 1 0.0003677937 0.06264286 0.1478071 0.4227189 0.3664634</span></code></pre></div>
<p>There are a few things to notice about the output. Even though we started out with sums which added to 24, the mean seems to add to 1. This is because we didn’t specify the units - and so the package didn’t know what units to return it to us in. But it could still return it as a sum to 1, without loss of information, as per the definition of compositional data.</p>
<p>We’ve also got a message about zeroes. Compositional data analysis can’t automatically include zero values. For more information about this issue, see <span class="citation">(Palarea-Albaladejo and Martín-Fernández 2015)</span> and <span class="citation">(Rasmussen et al. 2020)</span>. There are a couple of options:</p>
<ul>
<li><p>They can be dropped (this is the right option if they’re so called ‘true zeroes,’ and not related to a limit in the precision with which we can measure). To drop them, set <code>rounded_zeroes = FALSE</code>.</p></li>
<li><p>They can be imputed. This is the right option if they’re so-called ‘rounded zeroes’ i.e. they’re related to a limit in the precision with which we can measure. For example, with activity data, it might be that if we recorded data for long enough, we would eventually see some vigorous activity, but our measurement period wasn’t long enough. It might also be that our measurement device can’t record values lower than a certain level.</p></li>
</ul>
<p>To impute the zeroes, as per the second option, we need to specify the minimum value detectable in the data. This can be specified using the <code>det_limit</code> argument, and it should be specified with the same scale as the compositional columns in the input data. [Note that if the input data scale and the output scale (<code>units</code> argument), are different, it should match <em>the input data scale</em>.] The default in the function, if neither <code>rounded_zeroes</code> or <code>det_limit</code> is specified, is to impute zeroes with the detection limit (<code>det_limit</code>) set as the minimum non-zero value observed in the data. This might not always be a good default!</p>
<p>So we can now find the mean again, this time imputing the zeroes with a specified detection limit and specifying the units. In the simulated data, the shortest period of a behaviour we could detect was <span class="math inline">\(0.0012\ hr/day\)</span> (due to the length of an epoch for the accelerometer used to measure the data on which the simulated data is based).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/epicoda/man/comp_mean.html">comp_mean</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">simdata</span>, <span class="co"># this is the dataset</span>
          comp_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"vigorous"</span>, <span class="st">"moderate"</span>, <span class="st">"light"</span>, <span class="st">"sedentary"</span>, <span class="st">"sleep"</span><span class="op">)</span>, <span class="co"># this is the labels of the compositional columns,</span>
          <span class="co"># which we specified above</span>
          rounded_zeroes <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># this option specifies that we'll treat the zeroes</span>
          <span class="co"># as rounded zeroes i.e. we'll impute them</span>
          det_limit <span class="op">=</span> <span class="fl">0.0012</span>, <span class="co"># this is the smallest value observable in the data</span>
          units <span class="op">=</span> <span class="st">"hr/day"</span> <span class="co"># this is the units. There are pre-specified options "hr/day",</span>
          <span class="co"># "hr/wk", "min/day", "min/wk" and "unitless".</span>
          <span class="co"># If you set units = "specified", you can also specify your own units using</span>
          <span class="co"># specified = c("my_units_name", sum of a composition in these units)</span>
<span class="op">)</span>
<span class="co">#&gt; Zeroes were imputed with detection limit </span>
<span class="co">#&gt;  5e-05  (on the unitless scale) using zCompositions::lrEM</span>
<span class="co">#&gt;      vigorous moderate    light sedentary    sleep</span>
<span class="co">#&gt; 1 0.008835908 1.503428 3.547369  10.14525 8.795118</span></code></pre></div>
<p>Many other functions in the package have <code>rounded_zeroes</code> and <code>det_limit</code> arguments, because they use calculations which need zeroes to be imputed or excluded. For all of them, it works the same as for <code>comp_mean</code>. In the remainder of this vignette, they are left at the default.</p>
</div>
<div id="other-descriptive-statistics" class="section level3">
<h3 class="hasAnchor">
<a href="#other-descriptive-statistics" class="anchor"></a>Other descriptive statistics</h3>
<p>While the compositional mean is a fairly clear compositional equivalent to the mean for non-compositional data, other standard descriptive statistics (such as the variance), do not have straightforward compositional equivalents for all purposes for which they are used (there may be several alternatives, depending on the purpose of the analysis) <span class="citation">(Filzmoser, Hron, and Templ 2018)</span>. These are beyond the current scope of this package.</p>
</div>
<div id="plotting-ternary-diagrams" class="section level3">
<h3 class="hasAnchor">
<a href="#plotting-ternary-diagrams" class="anchor"></a>Plotting ternary diagrams</h3>
<p>Ternary plots provide a way to plot compositional data with three parts. The R package <code>ggtern</code> is an extension of <code>ggplot2</code> to carry out this plotting. Unfortunately, the current version causes some unfortunate masking of <code>ggplot2</code> methods, so isn’t shown in this vignette. But if you want to plot ternary plots, I (Rosemary) can share code and tips!</p>
</div>
</div>
<div id="regression-modelling" class="section level2">
<h2 class="hasAnchor">
<a href="#regression-modelling" class="anchor"></a>Regression modelling</h2>
<div id="setting-up-regression-models" class="section level3">
<h3 class="hasAnchor">
<a href="#setting-up-regression-models" class="anchor"></a>Setting up regression models</h3>
<p>The package has a wrapper for linear regression, logistic regression and Cox regression modelling using compositional variables, with adjustment for covariates. Compositional Data Analysis regression modelling works by transforming the variables making up the composition (see ‘Mechanics of Compositional Data Analysis’ below), and using the transformed variables (known as ‘log-ratio coordinates’) in the model. The package automates these steps. For example, to set up a linear regression model for the association between behaviour variables and <code>BMI</code>, adjusted for age and sex:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lm_BMI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/epicoda/man/comp_model.html">comp_model</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"linear"</span>,
         outcome <span class="op">=</span> <span class="st">"BMI"</span>,
         covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"agegroup"</span>, <span class="st">"sex"</span><span class="op">)</span>,
         data <span class="op">=</span> <span class="va">simdata</span>,
         comp_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"vigorous"</span>, <span class="st">"moderate"</span>, <span class="st">"light"</span>, <span class="st">"sedentary"</span>, <span class="st">"sleep"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; det_limit was imputed as the minimum value observed in the compositional</span>
<span class="co">#&gt;          columns of data; </span>
<span class="co">#&gt;  if this is an unrealistic det_limit, the results may be unreliable.</span>
<span class="co">#&gt; Zeroes were imputed with detection limit </span>
<span class="co">#&gt;  4.96e-05  (on the unitless scale) using zCompositions::lrEM</span></code></pre></div>
<p>Logistic models can be produced in exactly the same way by setting <code>type = "logistic"</code> and using an appropriate binary outcome variable. Cox models can be produced similarly by setting <code>type = "cox"</code> and either setting <code>outcome</code> as a <code>Surv</code> object from the package <code>survival</code> or setting the <code>follow_up_time</code> and <code>event</code> arguments. For examples, see ‘Regression modelling: further examples.’</p>
</div>
<div id="understanding-the-model-output" class="section level3">
<h3 class="hasAnchor">
<a href="#understanding-the-model-output" class="anchor"></a>Understanding the model output</h3>
<p>The model object is a standard <code>lm</code> object, and we can inspect it in the usual way:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">lm_BMI</span><span class="op">)</span></code></pre></div>
<p><img src="3_IntroToCompositionalDataAnalysis_files/figure-html/unnamed-chunk-8-1.png" width="700"><img src="3_IntroToCompositionalDataAnalysis_files/figure-html/unnamed-chunk-8-2.png" width="700"><img src="3_IntroToCompositionalDataAnalysis_files/figure-html/unnamed-chunk-8-3.png" width="700"><img src="3_IntroToCompositionalDataAnalysis_files/figure-html/unnamed-chunk-8-4.png" width="700"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">lm_BMI</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; stats::lm(formula = stats::as.formula(paste(outcome, "~", cov_sum, </span>
<span class="co">#&gt;     "+", transf_sum)), data = data_ready)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residuals:</span>
<span class="co">#&gt;      Min       1Q   Median       3Q      Max </span>
<span class="co">#&gt; -15.3461  -2.7022  -0.0575   2.7201  15.2465 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;                                Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="co">#&gt; (Intercept)                    25.69332    0.22068 116.426  &lt; 2e-16 ***</span>
<span class="co">#&gt; agegroupSecond youngest         0.30388    0.18648   1.630 0.103232    </span>
<span class="co">#&gt; agegroupMiddle                  0.69791    0.18045   3.868 0.000111 ***</span>
<span class="co">#&gt; agegroupSecond oldest           0.90323    0.18676   4.836 1.34e-06 ***</span>
<span class="co">#&gt; agegroupOldest                  1.09856    0.23841   4.608 4.12e-06 ***</span>
<span class="co">#&gt; sexMale                        -1.03684    0.08044 -12.890  &lt; 2e-16 ***</span>
<span class="co">#&gt; ilr_1_vigorous_vs_parts_2_to_5 -0.39318    0.02705 -14.538  &lt; 2e-16 ***</span>
<span class="co">#&gt; ilr_2_moderate_vs_parts_3_to_5 -1.12560    0.10910 -10.317  &lt; 2e-16 ***</span>
<span class="co">#&gt; ilr_3_light_vs_parts_4_to_5    -0.65501    0.11086  -5.908 3.57e-09 ***</span>
<span class="co">#&gt; ilr_4_sedentary_vs_part_5       2.12673    0.20999  10.128  &lt; 2e-16 ***</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residual standard error: 4.02 on 9990 degrees of freedom</span>
<span class="co">#&gt; Multiple R-squared:  0.1324, Adjusted R-squared:  0.1316 </span>
<span class="co">#&gt; F-statistic: 169.4 on 9 and 9990 DF,  p-value: &lt; 2.2e-16</span></code></pre></div>
<p>The model diagnostics can be interpreted as usual, and in this case all looks fine. However, the summary is hard to interpret because the transformed variables or ‘coordinates’ used in the model do not relate in a straightforward way to the original composition.</p>
</div>
<div id="presenting-the-results-tabulate-pivot-coordinate-coefficients" class="section level3">
<h3 class="hasAnchor">
<a href="#presenting-the-results-tabulate-pivot-coordinate-coefficients" class="anchor"></a>Presenting the results: tabulate pivot-coordinate coefficients</h3>
<p>One way to present the results is to present coefficients as usual for covariates, and then produce as many models as there are compositional variables. From each of these models, the coefficient for the first ‘ilr pivot coordinate’ is taken (see ‘Mechanics of Compositional Data Analysis’ below). These ilr pivot coordinate coefficients can be interpreted in terms of transfer between the particular compositional part and all other parts proportionally. <code>tab_coefs</code> is a function which wraps generating one model per compositional variable and outputting a table of model coefficients.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/epicoda/man/tab_coefs.html">tab_coefs</a></span><span class="op">(</span>scale_type <span class="op">=</span> <span class="st">"lp"</span>, <span class="co"># This argument can be "lp" or "exp" and determines whether coefficients are presented on the scale of the linear predictors ("lp") or are exponentiated ("exp"). # Exponentiation gives the Odds Ratio for logistic regression models and the Hazard Ratio for Cox regression models.</span>
          level <span class="op">=</span> <span class="fl">0.95</span>,
          type <span class="op">=</span> <span class="st">"linear"</span>,
          outcome <span class="op">=</span> <span class="st">"BMI"</span>, 
          data <span class="op">=</span> <span class="va">simdata</span>, 
          covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"agegroup"</span>, <span class="st">"sex"</span><span class="op">)</span>,
          follow_up_time <span class="op">=</span> <span class="st">"follow_up_time"</span>,
          event <span class="op">=</span> <span class="st">"event"</span>,
          comp_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"vigorous"</span>, <span class="st">"moderate"</span>, <span class="st">"light"</span>, <span class="st">"sedentary"</span>, <span class="st">"sleep"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; det_limit was imputed as the minimum value observed in the compositional</span>
<span class="co">#&gt;          columns of data; </span>
<span class="co">#&gt;  if this is an unrealistic det_limit, the results may be unreliable.</span>
<span class="co">#&gt; Zeroes were imputed with detection limit </span>
<span class="co">#&gt;  4.96e-05  (on the unitless scale) using zCompositions::lrEM</span>
<span class="co">#&gt; det_limit was imputed as the minimum value observed in the compositional</span>
<span class="co">#&gt;          columns of data; </span>
<span class="co">#&gt;  if this is an unrealistic det_limit, the results may be unreliable.</span>
<span class="co">#&gt; Zeroes were imputed with detection limit </span>
<span class="co">#&gt;  4.96e-05  (on the unitless scale) using zCompositions::lrEM</span>
<span class="co">#&gt; det_limit was imputed as the minimum value observed in the compositional</span>
<span class="co">#&gt;          columns of data; </span>
<span class="co">#&gt;  if this is an unrealistic det_limit, the results may be unreliable.</span>
<span class="co">#&gt; Zeroes were imputed with detection limit </span>
<span class="co">#&gt;  4.96e-05  (on the unitless scale) using zCompositions::lrEM</span>
<span class="co">#&gt; det_limit was imputed as the minimum value observed in the compositional</span>
<span class="co">#&gt;          columns of data; </span>
<span class="co">#&gt;  if this is an unrealistic det_limit, the results may be unreliable.</span>
<span class="co">#&gt; Zeroes were imputed with detection limit </span>
<span class="co">#&gt;  4.96e-05  (on the unitless scale) using zCompositions::lrEM</span>
<span class="co">#&gt; det_limit was imputed as the minimum value observed in the compositional</span>
<span class="co">#&gt;          columns of data; </span>
<span class="co">#&gt;  if this is an unrealistic det_limit, the results may be unreliable.</span>
<span class="co">#&gt; Zeroes were imputed with detection limit </span>
<span class="co">#&gt;  4.96e-05  (on the unitless scale) using zCompositions::lrEM</span>
<span class="co">#&gt; det_limit was imputed as the minimum value observed in the compositional</span>
<span class="co">#&gt;          columns of data; </span>
<span class="co">#&gt;  if this is an unrealistic det_limit, the results may be unreliable.</span>
<span class="co">#&gt; Zeroes were imputed with detection limit </span>
<span class="co">#&gt;  4.96e-05  (on the unitless scale) using zCompositions::lrEM</span>
<span class="co">#&gt;                                                             fit       2.5 %</span>
<span class="co">#&gt; (Intercept)                                          25.6933208 25.26073741</span>
<span class="co">#&gt; agegroupSecond youngest                               0.3038818 -0.06166417</span>
<span class="co">#&gt; agegroupMiddle                                        0.6979108  0.34420174</span>
<span class="co">#&gt; agegroupSecond oldest                                 0.9032342  0.53715161</span>
<span class="co">#&gt; agegroupOldest                                        1.0985605  0.63123845</span>
<span class="co">#&gt; sexMale                                              -1.0368409 -1.19451365</span>
<span class="co">#&gt; First pivot coordinate: vigorous vs All other parts  -0.3931843 -0.44619917</span>
<span class="co">#&gt; First pivot coordinate: moderate vs All other parts  -0.9915572 -1.20692738</span>
<span class="co">#&gt; First pivot coordinate: light vs All other parts     -0.1363588 -0.36174528</span>
<span class="co">#&gt; First pivot coordinate: sedentary vs All other parts  2.4418783  2.13238386</span>
<span class="co">#&gt; First pivot coordinate: sleep vs All other parts     -0.9207780 -1.28919004</span>
<span class="co">#&gt;                                                           97.5 %</span>
<span class="co">#&gt; (Intercept)                                          26.12590416</span>
<span class="co">#&gt; agegroupSecond youngest                               0.66942783</span>
<span class="co">#&gt; agegroupMiddle                                        1.05161995</span>
<span class="co">#&gt; agegroupSecond oldest                                 1.26931684</span>
<span class="co">#&gt; agegroupOldest                                        1.56588259</span>
<span class="co">#&gt; sexMale                                              -0.87916818</span>
<span class="co">#&gt; First pivot coordinate: vigorous vs All other parts  -0.34016948</span>
<span class="co">#&gt; First pivot coordinate: moderate vs All other parts  -0.77618698</span>
<span class="co">#&gt; First pivot coordinate: light vs All other parts      0.08902765</span>
<span class="co">#&gt; First pivot coordinate: sedentary vs All other parts  2.75137280</span>
<span class="co">#&gt; First pivot coordinate: sleep vs All other parts     -0.55236598</span></code></pre></div>
<div id="notes-1" class="section level4">
<h4 class="hasAnchor">
<a href="#notes-1" class="anchor"></a>Notes:</h4>
<ul>
<li>As these coefficients come from different models they do not parametrise a single model.</li>
<li>Arguments which would be needed for <code>comp_model</code> must be given to this function too, as it regenerates the regression models.</li>
<li>The function <code>tab_covariate_coefs</code> is called within this function, and can be used to extract the coefficients of the covariates only from a model.</li>
</ul>
</div>
</div>
<div id="presenting-the-results-substitution-plots" class="section level3">
<h3 class="hasAnchor">
<a href="#presenting-the-results-substitution-plots" class="anchor"></a>Presenting the results: substitution plots</h3>
<p>Substitution plots show the model-estimated difference in the outcome (relative to at the compositional mean) as the balance between two parts of the composition varies. In the case of time use/movement behaviours, they are known as isotemporal substitution plots and show the model-estimated difference in the outcome at higher time in one behaviour at the expense of time in another behaviour (the model-estimated difference in outcome for a hypothetical reallocation of time from one behaviour to another). For example:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/epicoda/man/plot_transfers.html">plot_transfers</a></span><span class="op">(</span>from_part <span class="op">=</span> <span class="st">"sedentary"</span>,
               to_part <span class="op">=</span> <span class="st">"moderate"</span>,
               model <span class="op">=</span> <span class="va">lm_BMI</span> ,
               comp_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"vigorous"</span>, <span class="st">"moderate"</span>, <span class="st">"light"</span>, <span class="st">"sedentary"</span>, <span class="st">"sleep"</span><span class="op">)</span>,
               y_label <span class="op">=</span> <span class="st">"Model-estimated difference in BMI"</span>,
               units <span class="op">=</span> <span class="st">"hr/day"</span><span class="op">)</span>
<span class="co">#&gt; [1] "Compositional variables not varied in the visualisation were fixed at:"</span>
<span class="co">#&gt; [1] "vigorous : 0.0088 hr/day"</span>
<span class="co">#&gt; [1] "light : 3.5 hr/day"</span>
<span class="co">#&gt; [1] "sleep : 8.8 hr/day"</span>
<span class="co">#&gt; fixed_values will be updated to have compositional parts fixed at the compositional mean. For technical and pragmatic reasons, use of a different reference for the compositional parts is not currently possible.</span>
<span class="co">#&gt; Please note that plotting may take some time.</span></code></pre></div>
<p><img src="3_IntroToCompositionalDataAnalysis_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<div id="notes-2" class="section level4">
<h4 class="hasAnchor">
<a href="#notes-2" class="anchor"></a>Notes</h4>
<ul>
<li>There is more information on how confidence intervals for this plot are calculated in a vignette (<code>vignette("derivation_of_CIs_used")</code>).</li>
<li>To customise the appearance of the plot see ‘Customising plots.’</li>
</ul>
</div>
</div>
<div id="presenting-the-results-estimates-at-particular-compositions" class="section level3">
<h3 class="hasAnchor">
<a href="#presenting-the-results-estimates-at-particular-compositions" class="anchor"></a>Presenting the results: estimates at particular compositions</h3>
<p>Another set of estimates that might be of interest are estimates at particular compositions. These can be examined by plotting these in a ‘forest plot’ style plot. This allows assessment of the model-estimated associations with much more complex substitutions of time.</p>
<div id="generating-perturbations-of-a-composition" class="section level4">
<h4 class="hasAnchor">
<a href="#generating-perturbations-of-a-composition" class="anchor"></a>Generating perturbations of a composition</h4>
<p>While there are hugely varied compositions which might be possible, one kind of composition is often of interest. This is compositions where one particular part is perturbed at the expense of all other parts proportionally. As this is a common use case, there is a function implemented to do this:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/pkg/epicoda/man/comp_mean.html">comp_mean</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">simdata</span>,
    comp_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"vigorous"</span>, <span class="st">"moderate"</span>, <span class="st">"light"</span>, <span class="st">"sedentary"</span>, <span class="st">"sleep"</span><span class="op">)</span>,
    units <span class="op">=</span> <span class="st">"hr/day"</span> <span class="co"># Note whatever the units are here is the units</span>
    <span class="co"># you should specify the changes in in the next two lines.</span>
  <span class="op">)</span>
<span class="op">)</span>
<span class="co">#&gt; det_limit was imputed as the minimum value observed in the compositional</span>
<span class="co">#&gt;          columns of data; </span>
<span class="co">#&gt;  if this is an unrealistic det_limit, the results may be unreliable.</span>
<span class="co">#&gt; Zeroes were imputed with detection limit </span>
<span class="co">#&gt;  4.96e-05  (on the unitless scale) using zCompositions::lrEM</span>
<span class="va">new_comp</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/pkg/epicoda/man/change_composition.html">change_composition</a></span><span class="op">(</span>
    composition <span class="op">=</span> <span class="va">df</span>,
    main_part <span class="op">=</span> <span class="st">"moderate"</span>,
    main_change <span class="op">=</span> <span class="op">+</span><span class="fl">0.5</span>,
    comp_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"vigorous"</span>, <span class="st">"moderate"</span>, <span class="st">"light"</span>, <span class="st">"sedentary"</span>, <span class="st">"sleep"</span><span class="op">)</span>
  <span class="op">)</span>
<span class="va">new_comp2</span> <span class="op">&lt;-</span>
    <span class="fu"><a href="https://rdrr.io/pkg/epicoda/man/change_composition.html">change_composition</a></span><span class="op">(</span>
    composition <span class="op">=</span> <span class="va">df</span>,
    main_part <span class="op">=</span> <span class="st">"sedentary"</span>,
    main_change <span class="op">=</span> <span class="op">-</span><span class="fl">3.5</span>,
    comp_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"vigorous"</span>, <span class="st">"moderate"</span>, <span class="st">"light"</span>, <span class="st">"sedentary"</span>, <span class="st">"sleep"</span><span class="op">)</span>
  <span class="op">)</span>
<span class="va">list_for_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"Extra 0.5 hr/day moderate"</span> <span class="op">=</span> <span class="va">new_comp</span>, <span class="st">"3.5 hr/day less sedentary"</span> <span class="op">=</span> <span class="va">new_comp2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">list_for_plot</span><span class="op">)</span>
<span class="co">#&gt; $`Extra 0.5 hr/day moderate`</span>
<span class="co">#&gt;      vigorous moderate    light sedentary    sleep</span>
<span class="co">#&gt; 1 0.008630863 2.003429 3.468528  9.919768 8.599644</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $`3.5 hr/day less sedentary`</span>
<span class="co">#&gt;     vigorous moderate    light sedentary    sleep</span>
<span class="co">#&gt; 1 0.01105695 1.883226 4.443511  6.645252 11.01695</span></code></pre></div>
</div>
<div id="plotting-estimates-at-particular-compositions" class="section level4">
<h4 class="hasAnchor">
<a href="#plotting-estimates-at-particular-compositions" class="anchor"></a>Plotting estimates at particular compositions</h4>
<p>We now need to plot these, which can be done as follows.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/epicoda/man/forest_plot_comp.html">forest_plot_comp</a></span><span class="op">(</span>composition_list <span class="op">=</span> <span class="va">list_for_plot</span>,
                 model <span class="op">=</span> <span class="va">lm_BMI</span>,
                 comp_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"vigorous"</span>, <span class="st">"moderate"</span>, <span class="st">"light"</span>, <span class="st">"sedentary"</span>, <span class="st">"sleep"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="3_IntroToCompositionalDataAnalysis_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<pre><code>#&gt; GRID.VP.11::forestplot_margins</code></pre>
<p>The <code>forest_plot_comp</code> function can also be used to compare models. To do this, leave <code>model</code> at its default <code>NULL</code> value, and set <code>models_list</code> as a named list of models. For example, to compare <code>lm_BMI</code> with a model adjusted for <code>age_group</code> only and an unadjusted model (very boring in the simulated data because the correlation structure for the simulation wasn’t sufficiently rich!):</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lm_BMI_unadjusted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/epicoda/man/comp_model.html">comp_model</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"linear"</span>,
         outcome <span class="op">=</span> <span class="st">"BMI"</span>,
         data <span class="op">=</span> <span class="va">simdata</span>,
         comp_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"vigorous"</span>, <span class="st">"moderate"</span>, <span class="st">"light"</span>, <span class="st">"sedentary"</span>, <span class="st">"sleep"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; det_limit was imputed as the minimum value observed in the compositional</span>
<span class="co">#&gt;          columns of data; </span>
<span class="co">#&gt;  if this is an unrealistic det_limit, the results may be unreliable.</span>
<span class="co">#&gt; Zeroes were imputed with detection limit </span>
<span class="co">#&gt;  4.96e-05  (on the unitless scale) using zCompositions::lrEM</span>
<span class="va">lm_BMI_age_group_only</span> <span class="op">&lt;-</span> <span class="va">lm_BMI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/epicoda/man/comp_model.html">comp_model</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"linear"</span>,
         outcome <span class="op">=</span> <span class="st">"BMI"</span>,
         covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"agegroup"</span><span class="op">)</span>,
         data <span class="op">=</span> <span class="va">simdata</span>,
         comp_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"vigorous"</span>, <span class="st">"moderate"</span>, <span class="st">"light"</span>, <span class="st">"sedentary"</span>, <span class="st">"sleep"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; det_limit was imputed as the minimum value observed in the compositional</span>
<span class="co">#&gt;          columns of data; </span>
<span class="co">#&gt;  if this is an unrealistic det_limit, the results may be unreliable.</span>
<span class="co">#&gt; Zeroes were imputed with detection limit </span>
<span class="co">#&gt;  4.96e-05  (on the unitless scale) using zCompositions::lrEM</span>
<span class="fu"><a href="https://rdrr.io/pkg/epicoda/man/forest_plot_comp.html">forest_plot_comp</a></span><span class="op">(</span>composition_list <span class="op">=</span> <span class="va">list_for_plot</span>,
                 models_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"Unadjusted"</span> <span class="op">=</span> <span class="va">lm_BMI_unadjusted</span>,
                                    <span class="st">"Age-adjusted"</span> <span class="op">=</span> <span class="va">lm_BMI_age_group_only</span>,
                                    <span class="st">"Age- and sex- adjusted"</span> <span class="op">=</span> <span class="va">lm_BMI</span><span class="op">)</span>,
                 comp_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"vigorous"</span>, <span class="st">"moderate"</span>, <span class="st">"light"</span>, <span class="st">"sedentary"</span>, <span class="st">"sleep"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="3_IntroToCompositionalDataAnalysis_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<pre><code>#&gt; GRID.VP.14::forestplot_margins</code></pre>
</div>
</div>
</div>
<div id="additional-information" class="section level2">
<h2 class="hasAnchor">
<a href="#additional-information" class="anchor"></a>Additional information</h2>
<p>This section contains lots of additional information, on:</p>
<ul>
<li>Mechanics of Compositional Data Analysis: Log-ratio transformations</li>
<li>Presenting results via model predictions</li>
<li>Customising plots</li>
<li>Regression modelling: further examples</li>
<li>Getting the numbers out: estimates/ predictions for particular compositions</li>
</ul>
<div id="mechanics-of-compositional-data-analysis-log-ratio-transformations" class="section level3">
<h3 class="hasAnchor">
<a href="#mechanics-of-compositional-data-analysis-log-ratio-transformations" class="anchor"></a>Mechanics of Compositional Data Analysis: Log-ratio transformations</h3>
<p>The functions above wrap all the ‘log-ratio mechanics’ of using a Compositional Data Analysis approach.</p>
<p>There are several different kinds of transformations which can be used in order to work with compositional data (alr, ilr, clr). These transform the variables into coordinates which are capable of representing all the variation in the data. Different transformations have different pros/cons, and alr and clr can only be used for certain applications. All the functions default to ilr (isometric log ratio) transformation using so-called ‘pivot coordinates,’ which is fairly standard in the time use/movement behaviour literature (and is appropriate for the applications which the other transformations are used for). If you want to learn more, see <span class="citation">(Filzmoser, Hron, and Templ 2018)</span><span class="citation">(Pawlowsky-Glahn, Egozcue, and Tolosana-Delgado 2011)</span>.</p>
<p>The purpose of this package is not to provide this functionality, which is implemented in other R packages, such as <code>compositions</code> and <code>robCompositions</code>. (The main aim of this package is shown above, in the functions to perform standard epidemiological analyses). This functionality is reimplemented here simply to ensure that future changes to the defaults in those packages do not affect this package.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_ilr_impute_zeroes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/epicoda/man/transform_comp.html">transform_comp</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">simdata</span>,
                                   comp_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"vigorous"</span>, <span class="st">"moderate"</span>, <span class="st">"light"</span>, <span class="st">"sedentary"</span>, <span class="st">"sleep"</span><span class="op">)</span>,
                                   transformation_type <span class="op">=</span> <span class="st">"ilr"</span><span class="op">)</span>
<span class="co">#&gt; det_limit was imputed as the minimum value observed in the compositional</span>
<span class="co">#&gt;          columns of data; </span>
<span class="co">#&gt;  if this is an unrealistic det_limit, the results may be unreliable.</span>
<span class="co">#&gt; Zeroes were imputed with detection limit </span>
<span class="co">#&gt;  4.96e-05  (on the unitless scale) using zCompositions::lrEM</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">data_ilr_impute_zeroes</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;   X    sex        agegroup follow_up_time event      BMI disease     vigorous</span>
<span class="co">#&gt; 1 1 Female   Second oldest             24  TRUE 29.11778       0 6.627545e-05</span>
<span class="co">#&gt; 2 2   Male Second youngest             23 FALSE 26.79845       0 1.825529e-04</span>
<span class="co">#&gt; 3 3 Female          Middle             21 FALSE 31.36632       0 1.971117e-03</span>
<span class="co">#&gt; 4 4   Male          Middle             17 FALSE 32.86039       0 8.443280e-04</span>
<span class="co">#&gt; 5 5 Female   Second oldest             14 FALSE 34.84146       0 9.444837e-05</span>
<span class="co">#&gt; 6 6 Female          Middle             14 FALSE 23.18320       0 8.864994e-04</span>
<span class="co">#&gt;     moderate     light sedentary     sleep ilr_1_vigorous_vs_parts_2_to_5</span>
<span class="co">#&gt; 1 0.01470883 0.1028469 0.4757121 0.4066659                      -6.786519</span>
<span class="co">#&gt; 2 0.04694317 0.2290063 0.3714990 0.3523690                      -6.231424</span>
<span class="co">#&gt; 3 0.06224302 0.1208710 0.4213707 0.3935441                      -4.076369</span>
<span class="co">#&gt; 4 0.07580553 0.1734216 0.4107843 0.3391443                      -4.920523</span>
<span class="co">#&gt; 5 0.04040858 0.1549336 0.4597970 0.3447664                      -6.742751</span>
<span class="co">#&gt; 6 0.08454686 0.1814139 0.2489476 0.4842052                      -4.879042</span>
<span class="co">#&gt;   ilr_2_moderate_vs_parts_3_to_5 ilr_3_light_vs_parts_4_to_5</span>
<span class="co">#&gt; 1                      -2.523223                  -1.1865007</span>
<span class="co">#&gt; 2                      -1.636546                  -0.3734355</span>
<span class="co">#&gt; 3                      -1.276028                  -0.9917403</span>
<span class="co">#&gt; 4                      -1.159234                  -0.6258620</span>
<span class="co">#&gt; 5                      -1.708819                  -0.7706337</span>
<span class="co">#&gt; 6                      -1.035944                  -0.5299835</span>
<span class="co">#&gt;   ilr_4_sedentary_vs_part_5</span>
<span class="co">#&gt; 1                0.11088910</span>
<span class="co">#&gt; 2                0.03738280</span>
<span class="co">#&gt; 3                0.04830928</span>
<span class="co">#&gt; 4                0.13551171</span>
<span class="co">#&gt; 5                0.20358888</span>
<span class="co">#&gt; 6               -0.47041451</span></code></pre></div>
<p>There are also a few other things we can do with this function, like specifying a given ‘first part’ (which is useful when it comes to reporting, and is used therefore in <code>tab_coefs</code>). To learn more, run <code><a href="https://rdrr.io/pkg/epicoda/man/transform_comp.html">?transform_comp</a></code>.</p>
</div>
<div id="presenting-results-via-model-predictions" class="section level3">
<h3 class="hasAnchor">
<a href="#presenting-results-via-model-predictions" class="anchor"></a>Presenting results via model predictions</h3>
<p>An alternative way to get round the challenges of interpreting the model coefficients for these models is to look at model-predicted outcomes for different input variable values (rather than model-estimated differences). The <code>plot_transfers</code> function can do this (for linear, logistic and Cox regression models) by setting <code>terms = FALSE</code>:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/epicoda/man/plot_transfers.html">plot_transfers</a></span><span class="op">(</span>from_part <span class="op">=</span> <span class="st">"sedentary"</span>,
               to_part <span class="op">=</span> <span class="st">"moderate"</span>,
               model <span class="op">=</span> <span class="va">lm_BMI</span> ,
               comp_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"vigorous"</span>, <span class="st">"moderate"</span>, <span class="st">"light"</span>, <span class="st">"sedentary"</span>, <span class="st">"sleep"</span><span class="op">)</span>,
               y_label <span class="op">=</span> <span class="st">"Model-predicted outcome"</span>,
               units <span class="op">=</span> <span class="st">"hr/day"</span>,
               terms <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; [1] "Compositional variables not varied in the visualisation were fixed at:"</span>
<span class="co">#&gt; [1] "vigorous : 0.0088 hr/day"</span>
<span class="co">#&gt; [1] "light : 3.5 hr/day"</span>
<span class="co">#&gt; [1] "sleep : 8.8 hr/day"</span>
<span class="co">#&gt; fixed_values will be updated to have compositional parts fixed at the compositional mean. For technical and pragmatic reasons, use of a different reference for the compositional parts is not currently possible.</span>
<span class="co">#&gt; Please note that plotting may take some time.</span></code></pre></div>
<p><img src="3_IntroToCompositionalDataAnalysis_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<div id="notes-3" class="section level4">
<h4 class="hasAnchor">
<a href="#notes-3" class="anchor"></a>Notes</h4>
<ul>
<li>The predictions and confidence intervals on this plot capture the predictions and uncertainty on them due to all variables in the model, including the covariates at the set fixed values.</li>
<li>The <code>fixed_values</code> argument can be used to set the values at which covariates (but not compositional variables) are fixed (which if not set default to median or modal values for continuous and categorical variables respectively)</li>
<li>Other functions, such as <code>forest_plot_comp</code>, can also output predictions by setting <code>terms = FALSE</code>.</li>
</ul>
</div>
</div>
<div id="customising-plots" class="section level3">
<h3 class="hasAnchor">
<a href="#customising-plots" class="anchor"></a>Customising plots</h3>
<p>All the plotting functions can have settings changed to make more visually attractive plots (e.g. changing text size, line size, text colour). <code>plot_transfers</code> is based on <code>ggplot2</code>.</p>
<ul>
<li>To specify non-data aspects of the plot (e.g. line, axis and text size and colours), set the optional <code>theme</code> argument. Note that you will need the <code>ggplot2</code> package loaded in order to do this.</li>
<li>For <code>plot_transfers</code>, to specify characteristics of the plotted prediction line, set the <code>point_specification</code> argument as a <code>geom_point</code> object.</li>
<li>For <code>plot_transfers</code>, to specify colours of the error bars, set the <code>error_bar_colour</code> argument as the name of a colour.</li>
<li>For <code>plot_transfers</code>, if the line looks ‘gappy’ (likely at the ends), increase <code>granularity</code> (and if it takes too long to plot, decrease <code>granularity</code>).</li>
</ul>
<p>For an extreme example of implementing some of this:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span> <span class="co"># it's easier to specify e.g. themes if ggplot2 is loaded.</span>
<span class="fu"><a href="https://rdrr.io/pkg/epicoda/man/plot_transfers.html">plot_transfers</a></span><span class="op">(</span>from_part <span class="op">=</span> <span class="st">"sedentary"</span>,
               to_part <span class="op">=</span> <span class="st">"moderate"</span>,
               model <span class="op">=</span> <span class="va">lm_BMI</span> ,
               comp_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"vigorous"</span>, <span class="st">"moderate"</span>, <span class="st">"light"</span>, <span class="st">"sedentary"</span>, <span class="st">"sleep"</span><span class="op">)</span>,
               y_label <span class="op">=</span> <span class="st">"Model-estimated difference in outcome"</span>,
               units <span class="op">=</span> <span class="st">"hr/day"</span>,
               point_specification <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.5</span>, colour <span class="op">=</span> <span class="st">"purple"</span><span class="op">)</span>,
               error_bar_colour <span class="op">=</span> <span class="st">"yellow"</span>,
               theme <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"red"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,
                                         text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>family <span class="op">=</span> <span class="st">"mono"</span>, face <span class="op">=</span> <span class="st">"bold.italic"</span>, colour <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span>,
                                         axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"blue"</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "Compositional variables not varied in the visualisation were fixed at:"</span>
<span class="co">#&gt; [1] "vigorous : 0.0088 hr/day"</span>
<span class="co">#&gt; [1] "light : 3.5 hr/day"</span>
<span class="co">#&gt; [1] "sleep : 8.8 hr/day"</span>
<span class="co">#&gt; fixed_values will be updated to have compositional parts fixed at the compositional mean. For technical and pragmatic reasons, use of a different reference for the compositional parts is not currently possible.</span>
<span class="co">#&gt; Please note that plotting may take some time.</span></code></pre></div>
<p><img src="3_IntroToCompositionalDataAnalysis_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<p>Slightly differently, <code>forest_plot_comp</code> is based on the <code>forestplot</code> package, so takes arguments specifying the plot in the same way as that function. There are several arguments which set particular aspects of the forest plot. In addition, any argument that the basic <code>forestplot</code> function can take, which isn’t already set, can be set as an argument to <code>forest_plot_comp</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://gforge.se/packages/">forestplot</a></span><span class="op">)</span> <span class="co"># it's easier to specify options such as fpColors if the forestplot package is loaded.</span>
<span class="co">#&gt; Loading required package: grid</span>
<span class="co">#&gt; Loading required package: magrittr</span>
<span class="co">#&gt; Loading required package: checkmate</span>
<span class="fu"><a href="https://rdrr.io/pkg/epicoda/man/forest_plot_comp.html">forest_plot_comp</a></span><span class="op">(</span>composition_list <span class="op">=</span> <span class="va">list_for_plot</span>,
                 model <span class="op">=</span> <span class="va">lm_BMI</span>,
                 comp_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"vigorous"</span>, <span class="st">"moderate"</span>, <span class="st">"light"</span>, <span class="st">"sedentary"</span>, <span class="st">"sleep"</span><span class="op">)</span>,
                 pred_name <span class="op">=</span> <span class="st">"The predicted difference at this composition"</span>, <span class="co"># This sets the name with which to label the column. ,</span>
                 title <span class="op">=</span> <span class="st">"Analysis of physical behaviour data"</span>, <span class="co"># This sets the overall plot title.</span>
                 col <span class="op">=</span> <span class="fu">forestplot</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/forestplot/man/fpColors.html">fpColors</a></span><span class="op">(</span>zero <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="co"># This sets the colour of the line at 0 (or 1, if it's the plot of a logistic or Cox model)</span>
<span class="op">)</span></code></pre></div>
<p><img src="3_IntroToCompositionalDataAnalysis_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
<pre><code>#&gt; GRID.VP.43::forestplot_margins</code></pre>
<p>For additional information on how to customise the functions, see the manual by running e.g. <code><a href="https://rdrr.io/pkg/epicoda/man/plot_transfers.html">?plot_transfers</a></code>.</p>
</div>
<div id="regression-modelling-further-examples" class="section level3">
<h3 class="hasAnchor">
<a href="#regression-modelling-further-examples" class="anchor"></a>Regression modelling: further examples</h3>
<p>As well as linear models, we can produce logistic and Cox models:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">log_outcome</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/epicoda/man/comp_model.html">comp_model</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"logistic"</span>,
                          outcome <span class="op">=</span> <span class="st">"disease"</span>,
                          covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"agegroup"</span>, <span class="st">"sex"</span><span class="op">)</span>,
                          data <span class="op">=</span> <span class="va">simdata</span>,
                          comp_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"vigorous"</span>, <span class="st">"moderate"</span>, <span class="st">"light"</span>, <span class="st">"sedentary"</span>, <span class="st">"sleep"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; det_limit was imputed as the minimum value observed in the compositional</span>
<span class="co">#&gt;          columns of data; </span>
<span class="co">#&gt;  if this is an unrealistic det_limit, the results may be unreliable.</span>
<span class="co">#&gt; Zeroes were imputed with detection limit </span>
<span class="co">#&gt;  4.96e-05  (on the unitless scale) using zCompositions::lrEM</span>
<span class="va">cox_outcome</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/epicoda/man/comp_model.html">comp_model</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"cox"</span>,
                          event <span class="op">=</span> <span class="st">"event"</span>,
                          follow_up_time <span class="op">=</span> <span class="st">"follow_up_time"</span>,
                          covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"agegroup"</span>, <span class="st">"sex"</span><span class="op">)</span>,
                          data <span class="op">=</span> <span class="va">simdata</span>,
                          comp_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"vigorous"</span>, <span class="st">"moderate"</span>, <span class="st">"light"</span>, <span class="st">"sedentary"</span>, <span class="st">"sleep"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; det_limit was imputed as the minimum value observed in the compositional</span>
<span class="co">#&gt;          columns of data; </span>
<span class="co">#&gt;  if this is an unrealistic det_limit, the results may be unreliable.</span>
<span class="co">#&gt; Zeroes were imputed with detection limit </span>
<span class="co">#&gt;  4.96e-05  (on the unitless scale) using zCompositions::lrEM</span></code></pre></div>
</div>
<div id="getting-the-numbers-out-predictions-for-particular-compositions" class="section level3">
<h3 class="hasAnchor">
<a href="#getting-the-numbers-out-predictions-for-particular-compositions" class="anchor"></a>Getting the numbers out: predictions for particular compositions</h3>
<p>To get the numbers out for predictions at particular compositions, we can use the <code>predict_fit_and_ci</code> function (which is wrapped in the plotting functions).This takes a data frame argument for <code>new_data</code>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/epicoda/man/predict_fit_and_ci.html">predict_fit_and_ci</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">lm_BMI</span>, new_data <span class="op">=</span> <span class="va">new_comp</span>, comp_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"vigorous"</span>, <span class="st">"moderate"</span>, <span class="st">"light"</span>, <span class="st">"sedentary"</span>, <span class="st">"sleep"</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"fit"</span>, <span class="st">"lower_CI"</span>, <span class="st">"upper_CI"</span><span class="op">)</span><span class="op">]</span>
<span class="co">#&gt;          fit   lower_CI   upper_CI</span>
<span class="co">#&gt; 1 -0.2700925 -0.3302163 -0.2099687</span></code></pre></div>
</div>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Filzmoser2018" class="csl-entry">
Filzmoser, Peter, Karel Hron, and Matthias Templ. 2018. <em><span>Applied Compositional Data Analysis</span></em>. <a href="https://doi.org/10.1007/978-3-319-96422-5">https://doi.org/10.1007/978-3-319-96422-5</a>.
</div>
<div id="ref-Palarea-Albaladejo2015" class="csl-entry">
Palarea-Albaladejo, Javier, and Josep Antoni Martín-Fernández. 2015. <span>“<span class="nocase">ZCompositions - R package for multivariate imputation of left-censored data under a compositional approach</span>.”</span> <a href="https://doi.org/10.1016/j.chemolab.2015.02.019">https://doi.org/10.1016/j.chemolab.2015.02.019</a>.
</div>
<div id="ref-Pawlowsky-Glahn2011" class="csl-entry">
Pawlowsky-Glahn, V, J J Egozcue, and R Tolosana-Delgado. 2011. <span>“<span class="nocase">Lecture notes on Compositional Data Analysis</span>,”</span> no. May: 1–100. <a href="https://doi.org/10.13140/RG.2.1.1296.2728">https://doi.org/10.13140/RG.2.1.1296.2728</a>.
</div>
<div id="ref-Rasmussen2020" class="csl-entry">
Rasmussen, Charlotte Lund, Javier Palarea-Albaladejo, Melker Staffan Johansson, Patrick Crowley, Matthew Leigh Stevens, Nidhi Gupta, Kristina Karstad, and Andreas Holtermann. 2020. <span>“<span class="nocase">Zero problems with compositional data of physical behaviors: a comparison of three zero replacement methods</span>.”</span> <em>International Journal of Behavioral Nutrition and Physical Activity</em>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by .</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
